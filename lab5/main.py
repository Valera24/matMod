import random

def main():
    print("Решение примера из практикума (2x2)")
    print("Система: x = -0.1x + 0.8y + 0.1")
    print("         y =  0.4x - 0.1y - 0.2")
    
    # 1. ПАРАМЕТРЫ СИСТЕМЫ (из раздела "Решение" на скриншоте)
    # -----------------------------------------------
    n = 3
    
    # Матрица перехода (обозначена 'a' в C++ коде)
    # x = a00*x + a01*y + f0
    # y = a10*x + a11*y + f1
    # a = [
    #     [0.75,  0.15, 0.1],  # Коэффициенты для x: -0.1 и 0.8
    #     [-0.15, 0.9, 0.35],   # Коэффициенты для y:  0.4 и -0.1
    #     [0.25, -0.05, 0.5]
    # ]
    
    # # Вектор свободных членов (обозначен 'f' в C++ коде)
    # f = [0.5, 2.5, 4.0]
    a = [
        [-0.1,  0.8, 0],  # Коэффициенты для x: -0.1 и 0.8
        [ 0.4, -0.1, 0],   # Коэффициенты для y:  0.4 и -0.1
        [0, 0, 0]
    ]
    
    # Вектор свободных членов (обозначен 'f' в C++ коде)
    f = [0.1, -0.2, 0]
    
    # 2. НАСТРОЙКА ВЕРОЯТНОСТЕЙ
    # -----------------------------------------------
    # В примере практикума используются вероятности 0.5 (равномерные)
    pi = [0.33, 0.33, 0.33]       # Начальные вероятности
    p = [                 # Матрица переходных вероятностей
        [0.33, 0.33, 0.33],
        [0.33, 0.33, 0.33],
        [0.33, 0.33, 0.33]
    ]
    
    # Вектор h (будем менять его, чтобы найти сначала x, потом y)
    h = [0.0] * n 

    # ПАРАМЕТРЫ МОДЕЛИРОВАНИЯ
    N = 1000      # Длина одной цепи (глубина)
    m = 10000     # Количество цепей (итераций)
    
    # Массивы
    chain_i = [0] * (N + 1)
    Q = [0.0] * (N + 1)
    ksi = [0.0] * m
    
    # Хранение результатов
    results = []

    # 3. ОСНОВНОЙ АЛГОРИТМ (один в один с C++)
    # -----------------------------------------------
    random.seed()
    # Цикл по переменным: сначала ищем x (индекс 0), потом y (индекс 1)
    for target_var in range(n):
        
        # Настраиваем h: (1, 0) для x, (0, 1) для y
        for k in range(n):
            h[k] = 1.0 if k == target_var else 0.0
            
        # Обнуляем ksi
        for j in range(m):
            ksi[j] = 0.0
            
        # Запускаем m цепей
        for j in range(m):
            
            # --- Выбор начального состояния ---
            alpha = random.random()
            if alpha < pi[0]:
                chain_i[0] = 0
            elif pi[0]<=alpha<(pi[0] + pi[1]):
                chain_i[0] = 1
            else:
                chain_i[0] = 2 
                
            # --- Генерация всей траектории ---
            for k in range(1, N + 1):
                alpha = random.random()
                if alpha < pi[0]:
                    chain_i[k] = 0
                elif pi[0]<=alpha<(pi[0] + pi[1]):
                    chain_i[k] = 1
                else:
                    chain_i[k] = 2 
            
            # --- Вычисление весов Q ---
            # Q0
            if pi[chain_i[0]] > 0:
                Q[0] = h[chain_i[0]] / pi[chain_i[0]]
            else:
                Q[0] = 0.0
                
            # Qk
            for k in range(1, N + 1):
                prev = chain_i[k-1]
                curr = chain_i[k]
                
                if p[prev][curr] > 0:
                    # Q[k] = Q[k-1] * a[prev][curr] / p[prev][curr]
                    Q[k] = Q[k-1] * a[prev][curr] / p[prev][curr]
                else:
                    Q[k] = 0.0
            
            # --- Накопление суммы ksi ---
            for k in range(0, N + 1):
                idx = chain_i[k]
                ksi[j] = ksi[j] + Q[k] * f[idx]
        
        # Усреднение
        x_val = sum(ksi) / m
        results.append(x_val)

    # 4. ВЫВОД
    print("-" * 30)
    print(f"Результат X: {results[0]:.5f}")
    print(f"Результат Y: {results[1]:.5f}")
    print(f"Результат z: {results[2]:.5f}")
    
    # Проверка "в лоб" подстановкой в систему из Решения:
    # x = -0.1*x + 0.8*y + 0.1
    # y =  0.4*x - 0.1*y - 0.2
    # Это система: 
    # 1.1x - 0.8y = 0.1
    # -0.4x + 1.1y = -0.2
    # Ее точное решение: x ≈ -0.056, y ≈ -0.202
    print("-" * 30)
    print("(Справочно) Ожидаемые значения для этой матрицы:")
    print("X ≈ -0.056")
    print("Y ≈ -0.202")

if __name__ == "__main__":
    main()